{% extends 'MainBundle:Default:sidebar.html.twig' %}
{% form_theme questionForm 'MainBundle:form:horizontal.html.twig' %}



{% block title %}Kreator ankiety{% endblock %}

{% block link %}
  	{{ parent() }}
  	<style type="text/css">
		li { list-style-type: none; }
	</style>
{% endblock %}

{% block container %}
  <div class="jumbotron">
  <h1>Nowa pytanie</h1>
  <p>Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive,
  mobile-first projects on the web.</p>
</div> 
  
        <div class="col-sm-12">
            {{ form_start(questionForm) }}                 	             
               		
               		            		     
               		 <div class="form-group">            
                        {{ form_label(questionForm.type, label|default(null), { 'label_attr': { 'class': 'col-sm-offset-0 col-sm-3' } }) }}
                        <div class="col-sm-6 input-group">
                            {{ form_widget(questionForm.type)}}
                            {{ form_errors(questionForm.type) }}
                        </div>
					</div>	       
               		
               		 <div class="form-group">            
                        {{ form_label(questionForm.questionText, label|default(null), { 'label_attr': { 'class': 'col-sm-offset-0 col-sm-3' } }) }}
                        <div class="col-sm-6 input-group">
                            {{ form_widget(questionForm.questionText)}}
                            {{ form_errors(questionForm.questionText) }}
                        </div>
					</div>	  
                   	
               <ul id="options" data-prototype="{{ form_widget(questionForm.options.vars.prototype) | e }}">
                     {% for option in questionForm.options %}
                        <li id="li1">
                            {{ form_errors(option) }}
                             {{ form_widget(option) }}
                        </li>
                         
                       
                     {% endfor %}
                 </ul>   
             <div class="col-sm-offset-8" id="divBtn">
               	 <button id="add-another-option" type="button" class="btn btn-default btn-xs "><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Dodaj  opcje </button>             	 
             </div> 	
               
            
					 
	
	
          	  
               	     	                           		                              
              <div class="col-sm-offset-1 row col-sm-10">
              		<br><br>
                   	 {{ form_widget(questionForm.addNextQuestion) }}
               		 {{ form_widget(questionForm.endCreateSurvey) }}
              </div> 
               	
             {{ form_end(questionForm) }}        
        </div>                   
    </div>         
    
 

         
{% endblock %}

        {% block script %} 
            {{ parent() }}
           
            <script type="text/javascript">

            // śledzenie jak dużo pól email zostało wyrenderowanych
            var optionCount = '{{ (questionForm.options) | length }}';

            updateOptionLabel();
            
            
			
            jQuery(document).ready(function() {

            	var widget = $('#li1');           
         	    addDeleteBtn(widget);                  
           
				
            
              
                jQuery('#add-another-option').click(function() {
                	optionCount++;
                	
                    var options = jQuery('#options');

                    //take template  prototype
                    var newWidget = options.attr('data-prototype');
                    newWidget = newWidget.replace(/__name__/g, optionCount);

                 	// add Li
                    newWidget = jQuery('<li id="li' + optionCount + '"></li>').html( newWidget);
                    newWidget.find('label').text('Opcja ' + optionCount); 
                    
					newLi = addDeleteBtn(newWidget);                  
                    newLi.appendTo(jQuery('#options'));
                    
                    return false;
                });
                // hide options
        	 	$('#options').hide();
        	 	$("#divBtn").hide(); 

            	// set initally value of selector for questions
        	    $('#question_type').val('1');   	     // 1 - text type

                // show fields for corect question
        	    $(document).on('change', '#question_type', function() {        	   
            	    var x = $( "#question_type" ).val();            	    
            	    if(x == 1){
            	    	$("#divBtn").hide(); 
            	    	$('#options').hide();
                	}
            	    	
            	    else{
            	    	$("#divBtn").show();      
            	    	$('#options').show();          	    	           	    
                	}
            	    	
            	});

        	    
				function addDeleteBtn(widget) {           		
                    // add class to div for delte btn
            	    var classAttribute =  widget.find('input').parent('div').attr('class');         	    
            	    widget.find('input').parent('div').attr('class', 'input-group  input-group-sm ' + classAttribute);
            	    
            	    // add class to div for delte btn
            	    widget.find('input').after(' <span class="input-group-addon delete">X</span>');  
            	    widget.find('span').attr('id', 'delete' + optionCount);    
            	  
            	    return widget; 
            	}
            	
        	   // delete option fields  if user click x
        	    $(document).on('click','.delete', function() {        	
        	    	var deleteID = $(this).attr('id');    // substring delete from "delete + ID"
        	    	var ID = deleteID.substring(6);       	    
        	    	 $('#li' + ID).remove();  
        	    	 optionCount--;  
        	    	 updateOptionLabel();     	      
            	});
            	
            })
            
    
    	  
                            
    	    function updateOptionLabel() {           	  
          			 $( "#options" ).find('label').each(function( index ) {          	    
          				var counter = parseInt(index) + 1;  
          				$(this).text('Opcja ' + counter);      
          			 });
      			 }
            
            
           
            
      


            {#

        	$(document).ready(function() {        

            		// create copy of option field and hides them  	
            	    var original_form = $('.form-group:last');
            	    $("#divBtn").hide(); 
            	    original_form.hide();   

            	    // init option numeric
            	    var counter = 1; // count option
            	    $(original_form).find('label').text('Opcja ' + counter);   
    
            	   // add class to div for delte btn
            	    var classAttribute =  $(original_form).find('input').parent('div').attr('class');         	    
            	    $(original_form).find('input').parent('div').attr('class', 'input-group  input-group-sm ' + classAttribute);

            	    // add span btn to delete option
            	    $(original_form).find('input').after(' <span class="input-group-addon delete">X</span>');  

            	    // add class to div for autonumeric
            	    classAttribute =  $(original_form).find('input').parent('div').parent('div').attr('class');         	                	   
            	    $(original_form).find('input').parent('div').parent('div').attr('class', 'option ' + classAttribute);
   
					// set initally value of selector for questions
            	    $('#question_type').val('1');   	     // 1 - text type


					//add option field if user click plus button
            	    $( "#addBtn" ).click(function() {  	        							
	          			addForm();	        		 
	        		});     

            	    function addForm() {           	  
            	        var new_form = original_form.clone(true);    
            	        $(new_form).attr('id', 'option' + counter);          	            	        
            	        $(new_form).find('input').val('');   
            	        $(new_form).find('label').text('Opcja ' + counter); 
            	        $(new_form).find('span').attr('id', 'delete' + counter);          	    
    					$("#divBtn").before($(new_form).show());	
    					counter++;    		
            	    }

       	   
					// delete option fields  if user click x
            	    $(document).on('click','.delete', function() {        	
            	    	var deleteID = $(this).attr('id');    // substring delete from "delete + ID"
            	    	var ID = deleteID.substring(6); 
            	    	var optionID = 'option' + ID;
            	    	 $('#' + optionID).remove();  
            	    	 counter--;  
            	    	 updateOptionLabel();     	      
                	});

            	    function updateOptionLabel() {           	  
           	    	 $( ".option" ).each(function( index ) {
               	    	$(this).find('label').text('Opcja ' + index); 
                
               	    });

           	    	 $("#divBtn").hide(); 
           	    }

            	   
               	    


					// show fields for corect question
            	    $(document).on('change', '#question_type', function() {        	   
                	    var x = $( "#question_type" ).val();
                	    
                	    if(x == 1){
                	    	$('.optionCls').hide();
                	    	$('.delete').hide();
                	    	$("[for='question_option']").hide();
                	    	$("#divBtn").hide();
                    	}
                	    else{
                	    	$('.optionCls').show();
                	    	$('.delete').show();
                    	    $("[for='question_option']").show();
                    	   $("#divBtn").show();
                    	}
        	    
                	});

            	  
         
            	  

                	
   			
          	});
        	

            #}
            </script>
              <script src="{{ asset('bundles/main/js/jquery2.js') }}"></script>
            
        {% endblock %}

